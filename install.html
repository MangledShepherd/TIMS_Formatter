<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIMS Live Formatter - Bookmarklet Installer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            max-width: 800px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            padding: 40px;
        }

        .step {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            margin-right: 12px;
        }

        .step-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
        }

        .step-content {
            color: #555;
            line-height: 1.6;
        }

        .bookmarklet-box {
            background: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin: 30px 0;
        }

        .bookmarklet-link {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 16px 32px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            cursor: move;
            transition: all 0.3s;
            border: 3px dashed rgba(255, 255, 255, 0.3);
        }

        .bookmarklet-link:hover {
            background: #2980b9;
            transform: scale(1.05);
        }

        .desktop-only {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            color: #856404;
        }

        .mobile-only {
            background: #d1ecf1;
            border: 1px solid #0c5460;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            color: #0c5460;
        }

        .code-box {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            word-break: break-all;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .copy-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }

        .copy-button:hover {
            background: #218838;
        }

        .copy-button:active {
            background: #1e7e34;
        }

        .platform-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: #e9ecef;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .success {
            color: #28a745;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì± TIMS Live Roster Formatter</h1>
            <p>Install the bookmarklet to format your TIMS roster on any device</p>
        </div>

        <div class="content">
            <div class="platform-tabs">
                <button class="tab active" onclick="showTab('desktop')">üñ•Ô∏è Desktop</button>
                <button class="tab" onclick="showTab('mobile')">üì± Mobile</button>
            </div>

            <!-- Desktop Instructions -->
            <div id="desktop" class="tab-content active">
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">1</span>
                        Drag the Button to Your Bookmarks Bar
                    </div>
                    <div class="step-content">
                        <p>Make sure your bookmarks bar is visible in your browser (Ctrl+Shift+B in Chrome/Edge/Firefox).</p>
                    </div>
                </div>

                <div class="bookmarklet-box">
                    <p style="margin-bottom: 15px; opacity: 0.9;">üëá Drag this button to your bookmarks bar üëá</p>
                    <a href="" id="bookmarklet-link" class="bookmarklet-link">‚ö° Format TIMS</a>
                    <p style="margin-top: 15px; opacity: 0.8; font-size: 14px;">Then use it when viewing your TIMS roster!</p>
                </div>

                <div class="step">
                    <div class="step-title">
                        <span class="step-number">2</span>
                        How to Use
                    </div>
                    <div class="step-content">
                        <ol style="margin-left: 20px; line-height: 2;">
                            <li>Log into TIMS Employee Self Service</li>
                            <li>Navigate to your roster page</li>
                            <li>Click the "‚ö° Format TIMS" bookmark you just added</li>
                            <li>Your roster will instantly reformat with dark theme!</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Mobile Instructions -->
            <div id="mobile" class="tab-content">
                <div class="mobile-only">
                    <strong>üì± Mobile Setup Required</strong><br>
                    Mobile browsers don't support drag-and-drop. Follow these steps instead:
                </div>

                <div class="step">
                    <div class="step-title">
                        <span class="step-number">1</span>
                        Copy the Bookmarklet Code
                    </div>
                    <div class="step-content">
                        <p>Tap the button below to copy the code to your clipboard:</p>
                        <button class="copy-button" onclick="copyBookmarklet()">üìã Copy Bookmarklet Code</button>
                        <p id="copy-status" style="margin-top: 10px; color: #28a745; font-weight: 600; display: none;">‚úì Copied!</p>
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">
                        <span class="step-number">2</span>
                        Create a Bookmark in Your Browser
                    </div>
                    <div class="step-content">
                        <p><strong>iPhone (Safari):</strong></p>
                        <ol style="margin-left: 20px; line-height: 1.8;">
                            <li>Go to any website (like google.com)</li>
                            <li>Tap Share ‚Üí Add Bookmark</li>
                            <li>Name it "Format TIMS" and save</li>
                            <li>Go to Bookmarks ‚Üí Edit</li>
                            <li>Tap your bookmark ‚Üí tap the URL field</li>
                            <li>Delete the URL and paste the code you copied</li>
                            <li>Tap Done</li>
                        </ol>
                        <br>
                        <p><strong>Android (Chrome/Firefox):</strong></p>
                        <ol style="margin-left: 20px; line-height: 1.8;">
                            <li>Bookmark any page (tap ‚≠ê)</li>
                            <li>Go to Bookmarks ‚Üí find your bookmark</li>
                            <li>Tap "Edit"</li>
                            <li>Replace the URL with the code you copied</li>
                            <li>Save</li>
                        </ol>
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">
                        <span class="step-number">3</span>
                        Use It on TIMS
                    </div>
                    <div class="step-content">
                        <ol style="margin-left: 20px; line-height: 1.8;">
                            <li>Log into TIMS on your phone</li>
                            <li>Go to your roster page</li>
                            <li>Tap the address bar and type "Format TIMS"</li>
                            <li>Select your bookmark from suggestions</li>
                            <li>Page reformats instantly!</li>
                        </ol>
                    </div>
                </div>

                <div class="desktop-only">
                    <strong>üí° Tip:</strong> For detailed mobile instructions, see <strong>MOBILE_LIVE_SETUP.md</strong> in the project folder.
                </div>
            </div>

            <div class="step" style="background: #e7f3ff; border-color: #0066cc;">
                <div class="step-title" style="color: #0066cc;">
                    ‚ú® Features
                </div>
                <div class="step-content">
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li><strong>Always Current:</strong> Pulls live data from TIMS</li>
                        <li><strong>Dark Theme:</strong> Easy on the eyes</li>
                        <li><strong>Quick View:</strong> Today & tomorrow at the top</li>
                        <li><strong>Auto-Highlight:</strong> Today's date highlighted in green</li>
                        <li><strong>Mobile Optimized:</strong> Works perfectly on phones</li>
                        <li><strong>One-Click Refresh:</strong> Tap üîÑ to reload latest data</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // This will be replaced with the actual bookmarklet code
        const bookmarkletCode = 'javascript:(function(){\'use strict\';function getLocalDateStr(date){const year = date.getFullYear();const month = String(date.getMonth()+ 1).padStart(2,\'0\');const day = String(date.getDate()).padStart(2,\'0\');return `${year}-${month}-${day}`;}function extractRosterData(){const allDays =[];const dayNames =[\'Sunday\',\'Monday\',\'Tuesday\',\'Wednesday\',\'Thursday\',\'Friday\',\'Saturday\'];const rows = document.querySelectorAll(\'table tbody tr\');rows.forEach(row =>{const cells = row.querySelectorAll(\'td\');if(cells.length >= 11){const weekStart = cells[0].textContent.trim();const dept = cells[1].textContent.trim();const employee = cells[2].textContent.trim();const rosterType = cells[3].textContent.trim();if(!weekStart || weekStart.includes(\'No data\'))return;let startDate;try{const parts = weekStart.split(\'-\');if(parts.length === 3){startDate = new Date(parseInt(parts[0]),parseInt(parts[1])- 1,parseInt(parts[2]));}else{return;}}catch(e){return;}for(let i = 0;i < 7;i++){const currentDate = new Date(startDate);currentDate.setDate(currentDate.getDate()+ i);const dateStr = getLocalDateStr(currentDate);const dayName = dayNames[currentDate.getDay()];const shiftData = cells[4 + i].textContent.trim();allDays.push({date:currentDate,dateStr:dateStr,dayName:dayName,rosterType:rosterType,shiftData:shiftData,dept:dept,employee:employee});}}});return allDays;}function filterDays(allDays){const daysByDate ={};allDays.forEach(day =>{if(!daysByDate[day.dateStr]){daysByDate[day.dateStr]=[];}daysByDate[day.dateStr].push(day);});const filtered =[];for(let dateStr in daysByDate){const dayEntries = daysByDate[dateStr];const nonOff = dayEntries.filter(e => e.shiftData.toUpperCase()!== \'OFF\');if(nonOff.length > 0){filtered.push(...nonOff);}else{const normal = dayEntries.find(e => e.rosterType.toUpperCase()=== \'NORMAL\');filtered.push(normal || dayEntries[0]);}}filtered.sort((a,b)=> b.date - a.date);return filtered;}function generateHTML(days){const today = new Date();today.setHours(0,0,0,0);const tomorrow = new Date(today);tomorrow.setDate(tomorrow.getDate()+ 1);const todayStr = getLocalDateStr(today);const tomorrowStr = getLocalDateStr(tomorrow);let html = `<!DOCTYPE html><html lang="en"><head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <title>TIMS Roster - Live</title> <style> *{margin:0;padding:0;box-sizing:border-box;}body{font-family:-apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,Oxygen,Ubuntu,sans-serif;background:#121212;color:#e0e0e0;padding:0;font-size:15px;line-height:1.5;}.header{background:#1f1f1f;color:#ffffff;padding:20px;text-align:center;border-bottom:2px solid #2196f3;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,0.5);}.header h1{font-size:22px;font-weight:600;}.refresh-btn{background:#2196f3;color:white;border:none;padding:8px 16px;border-radius:4px;margin-top:10px;cursor:pointer;font-size:14px;font-weight:600;}.refresh-btn:hover{background:#1976d2;}.quick-view{max-width:800px;margin:15px auto;padding:0 10px;}.quick-view-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}.quick-shift{background:#1e1e1e;border-radius:6px;padding:12px;border:2px solid #2196f3;}.quick-shift.today-shift{border-color:#4caf50;background:#1a2e1a;}.quick-shift.tomorrow-shift{border-color:#ff9800;background:#2e2419;}.quick-shift-header{font-weight:600;font-size:13px;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;}.quick-shift.today-shift .quick-shift-header{color:#4caf50;}.quick-shift.tomorrow-shift .quick-shift-header{color:#ff9800;}.quick-date{font-size:15px;font-weight:600;color:#ffffff;margin-bottom:6px;}.quick-details{font-size:13px;color:#b0b0b0;line-height:1.6;}.quick-code{color:#64b5f6;font-weight:600;}.quick-hours{color:#ffb74d;}.quick-off{color:#888;font-style:italic;}.divider{height:20px;}.roster-list{max-width:800px;margin:0 auto;padding:10px;}.day-entry{background:#1e1e1e;border-left:4px solid #2196f3;margin-bottom:4px;border-radius:4px;overflow:hidden;transition:transform 0.2s,box-shadow 0.2s;}.day-entry:hover{transform:translateX(4px);box-shadow:0 4px 12px rgba(33,150,243,0.3);}.day-entry.off{border-left-color:#555;opacity:0.6;}.day-entry.leave{border-left-color:#ffa726;}.day-entry.today{border-left-width:6px;border-left-color:#4caf50;background:#1a2e1a;box-shadow:0 0 15px rgba(76,175,80,0.4);}.day-entry.today .day-header{background:#2d4a2d;}.day-entry.today .date::after{content:"(TODAY)";color:#4caf50;font-size:12px;font-weight:700;margin-left:8px;}.day-header{padding:8px 12px;display:flex;justify-content:space-between;align-items:center;background:#252525;flex-wrap:wrap;gap:8px;}.date-info{display:flex;align-items:center;gap:10px;}.date{font-weight:600;font-size:14px;color:#ffffff;}.day-name{color:#90caf9;font-size:13px;font-weight:500;}.roster-type{background:#2196f3;color:white;padding:2px 10px;border-radius:10px;font-size:11px;font-weight:600;text-transform:uppercase;}.roster-type.ado{background:#ff9800;}.roster-type.pro{background:#9c27b0;}.roster-type.votsun{background:#4caf50;}.shift-details{padding:8px 12px;display:flex;flex-wrap:wrap;gap:12px;align-items:center;}.shift-code{font-weight:600;color:#64b5f6;font-size:14px;}.shift-hours{color:#ffb74d;font-size:13px;font-weight:500;}.shift-times{color:#b0b0b0;font-size:13px;}.off-day{color:#777;font-style:italic;font-size:13px;padding:8px 12px;}.leave-badge{background:#ff9800;color:#000;padding:4px 10px;border-radius:4px;display:inline-block;font-weight:600;font-size:12px;}@media(max-width:600px){.quick-view-grid{grid-template-columns:1fr;}.day-header{flex-direction:column;align-items:flex-start;}.date-info{width:100%;}}</style></head><body> <div class="header"> <h1>TIMS Roster - Live</h1> <button class="refresh-btn" onclick="location.reload()">üîÑ Refresh from TIMS</button> </div> <div class="quick-view"> <div class="quick-view-grid"> <div class="quick-shift today-shift"> <div class="quick-shift-header">Today</div> <div class="quick-date" id="today-date">Loading...</div> <div class="quick-details" id="today-details">...</div> </div> <div class="quick-shift tomorrow-shift"> <div class="quick-shift-header">Tomorrow</div> <div class="quick-date" id="tomorrow-date">Loading...</div> <div class="quick-details" id="tomorrow-details">...</div> </div> </div> </div> <div class="divider"></div> <div class="roster-list">`;days.forEach(day =>{const lines = day.shiftData.split(\'\\n\').map(l => l.trim()).filter(l => l);const isOff = !lines.length || day.shiftData.toUpperCase()=== \'OFF\';const isLeave = day.shiftData.includes(\'A/L\')|| day.shiftData.includes(\'PHOL\')|| day.shiftData.includes(\'ADO/Off\');let entryClass = \'day-entry\';if(isOff)entryClass += \' off\';else if(isLeave)entryClass += \' leave\';if(day.dateStr === todayStr)entryClass += \' today\';let rosterClass = \'roster-type\';const rosterLower = day.rosterType.toLowerCase();if(rosterLower.includes(\'ado\'))rosterClass += \' ado\';else if(rosterLower.includes(\'pro\'))rosterClass += \' pro\';else if(rosterLower.includes(\'votsun\'))rosterClass += \' votsun\';html += ` <div class="${entryClass}" data-date="${day.dateStr}"> <div class="day-header"> <div class="date-info"> <span class="date">${day.dateStr}</span> <span class="day-name">${day.dayName}</span> </div> <span class="${rosterClass}">${day.rosterType}</span> </div>`;if(isOff){html += \' <div class="off-day">OFF</div>\\n\';}else if(lines.length > 0){html += \' <div class="shift-details">\\n\';if(isLeave){html += ` <span class="leave-badge">${lines[0]}</span>\\n`;if(lines.length > 1){html += ` <span class="shift-hours">${lines[1]} hours</span>\\n`;}if(lines.length > 2){html += ` <span class="shift-times">${lines.slice(2).join(\' | \')}</span>\\n`;}}else{html += ` <span class="shift-code">${lines[0]}</span>\\n`;if(lines.length > 1){html += ` <span class="shift-hours">${lines[1]} hours</span>\\n`;}if(lines.length > 2){html += ` <span class="shift-times">${lines.slice(2).join(\' | \')}</span>\\n`;}}html += \' </div>\\n\';}html += \' </div>\\n\';});html += ` </div> <script> function formatDate(date){const days =[\'Sunday\',\'Monday\',\'Tuesday\',\'Wednesday\',\'Thursday\',\'Friday\',\'Saturday\'];const months =[\'Jan\',\'Feb\',\'Mar\',\'Apr\',\'May\',\'Jun\',\'Jul\',\'Aug\',\'Sep\',\'Oct\',\'Nov\',\'Dec\'];return days[date.getDay()]+ \',\' + months[date.getMonth()]+ \' \' + date.getDate();}function getLocalDateStr(date){const year = date.getFullYear();const month = String(date.getMonth()+ 1).padStart(2,\'0\');const day = String(date.getDate()).padStart(2,\'0\');return year + \'-\' + month + \'-\' + day;}const today = new Date();today.setHours(0,0,0,0);const tomorrow = new Date(today);tomorrow.setDate(tomorrow.getDate()+ 1);const todayStr = getLocalDateStr(today);const tomorrowStr = getLocalDateStr(tomorrow);const todayEntry = document.querySelector(\'[data-date="\' + todayStr + \'"]\');const tomorrowEntry = document.querySelector(\'[data-date="\' + tomorrowStr + \'"]\');function extractShiftInfo(entry){if(!entry)return \'<span class="quick-off">No roster data</span>\';const offDay = entry.querySelector(\'.off-day\');if(offDay)return \'<span class="quick-off">OFF</span>\';const shiftDetails = entry.querySelector(\'.shift-details\');if(!shiftDetails)return \'<span class="quick-off">No details</span>\';const code = entry.querySelector(\'.shift-code\');const hours = entry.querySelector(\'.shift-hours\');const times = entry.querySelector(\'.shift-times\');const leave = entry.querySelector(\'.leave-badge\');let html = \'\';if(leave)html += \'<div><span style="background:#ff9800;color:#000;padding:2px 8px;border-radius:3px;font-weight:600;font-size:11px;">\' + leave.textContent + \'</span></div>\';if(code)html += \'<div><span class="quick-code">\' + code.textContent + \'</span></div>\';if(hours)html += \'<div><span class="quick-hours">\' + hours.textContent + \'</span></div>\';if(times)html += \'<div>\' + times.textContent + \'</div>\';return html || \'<span class="quick-off">No details</span>\';}document.getElementById(\'today-date\').textContent = formatDate(today);document.getElementById(\'today-details\').innerHTML = extractShiftInfo(todayEntry);document.getElementById(\'tomorrow-date\').textContent = formatDate(tomorrow);document.getElementById(\'tomorrow-details\').innerHTML = extractShiftInfo(tomorrowEntry);if(todayEntry){setTimeout(()=>{todayEntry.scrollIntoView({behavior:\'smooth\',block:\'center\'});},100);}<\\/script></body></html>`;return html;}try{const allDays = extractRosterData();if(allDays.length === 0){alert(\'No roster data found on this page. Make sure you are on the TIMS roster page.\');return;}const filteredDays = filterDays(allDays);const html = generateHTML(filteredDays);document.open();document.write(html);document.close();}catch(error){alert(\'Error formatting roster:\' + error.message);console.error(\'TIMS Formatter Error:\',error);}})();';

        // Set the bookmarklet link
        document.getElementById('bookmarklet-link').href = bookmarkletCode;

        function showTab(tab) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(el => {
                el.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
        }

        function copyBookmarklet() {
            const textArea = document.createElement('textarea');
            textArea.value = bookmarkletCode;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            const status = document.getElementById('copy-status');
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
